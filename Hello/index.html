<!DOCTYPE html>
<html>
  <head>
    <title>A-Frame / WebXR / AR / Light</title>
    <meta name="description" content="A-Frame WebAR Light">
    <script src='../../../vendor/aframe-master.js'></script>
    <script src='../../../vendor/three.xr.js'></script>
    <script src='../../../dist/aframe-xr.js'></script>
    <!-- From Don McCurdyâ€™s aframe-extras package https://github.com/donmccurdy/aframe-extras -->
    <script src='vendor/animation-mixer.js'></script>
  </head>
  <body>
    <a-scene>
        <!-- <a-assets>
            <a-asset-item id="dioramaSource" src="assets/webxr-town.gltf">
          </a-assets>
      <a-entity reticle geometry="primitive: ring; radiusInner: 0.04; radiusOuter: 0.05"
      material="color: #aaaaaa"></a-entity>
     <a-gltf-model id="diorama" src="#dioramaSource" position="0 0.5 1" animation-mixer visible="false"></a-gltf-model> -->
     <a-entity reticle geometry="primitive: ring; radiusInner: 0.04; radiusOuter: 0.05"
     material="color: #aaaaaa"></a-entity>
     <a-entity id="diorama" position="0 0.5 1" scale="1 1 1" visible="false">
        <a-entity position="2.071 0.525 1.631" scale="0.075 0.395 0.046" id="LetterH" geometry="" material="color:#ff0000;emissive:#ff0000"></a-entity><a-entity position="2.88 0.509 1.999" scale="0.047 0.304 0.039" id="Obscure" geometry="" material="color:#0000ff;emissive:#0000ff"></a-entity><a-entity position="2.88 0.603 1.001" scale="0.033 0.216 -0.023" id="Obscure-5" geometry="" material="color:#0000ff;emissive:#0000ff"></a-entity><a-entity position="-3.439 0.468 0.636" scale="0.047 0.817 0.155" id="Obscure-4" geometry="" material="color:#0000ff;emissive:#0000ff"></a-entity><a-entity position="2.775 0.642 1.496" scale="0.035 0.225 0.031" id="Obscure-3" geometry="" material="color:#0000ff;emissive:#0000ff"></a-entity><a-entity position="1.253 0.553 0.114" scale="0.063 0.528 0.039" id="Obscure-2" geometry="" material="color:#0000ff;emissive:#0000ff"></a-entity><a-entity position="1.425 0.478 1.8" scale="0.154 0.551 0.07" id="LetterH-2" geometry="" material="color:#ff0000;emissive:#ff0000"></a-entity><a-entity position="-1.737 0.195 0.989" rotation="-88.751 0 0" scale="0.305 0.766 0.163" id="LetterH-3" geometry="" material="color:#ff0000;emissive:#ff0000"></a-entity><a-entity position="-1.406 0.233 0.28" scale="0.154 1.17 0.173" id="LetterE" geometry="" material="color:#ff0000;emissive:#ff0000"></a-entity><a-entity position="1.991 0.717 1.377" rotation="89.381 0 0" scale="0.154 0.173 0.044" id="LetterE-2" geometry="" material="color:#ff0000;emissive:#ff0000"></a-entity><a-entity position="0.219 0.386 0.668" rotation="89.381 0 0" scale="0.203 0.37 0.091" id="LetterE-3" geometry="" material="color:#ff0000;emissive:#ff0000"></a-entity><a-entity position="1.391 0.234 1.143" rotation="89.381 0 0" scale="0.127 0.267 0.054" id="LetterE-4" geometry="" material="color:#ff0000;emissive:#ff0000"></a-entity><a-entity position="1.735 0.503 1.026" scale="0.084 0.459 0.085" id="LetterL" geometry="" material="color:#ff0000;emissive:#ff0000"></a-entity><a-entity position="-1.805 -0.356 -1.111" rotation="88.923 180.023 180.023" scale="0.228 0.778 0.165" id="LetterL-lower" geometry="" material="color:#ff0000;emissive:#ff0000"></a-entity><a-entity position="1.225 0.223 0.162" rotation="88.923 180.023 180.023" scale="0.147 0.34 0.085" id="LetterL-lower-2" geometry="" material="color:#ff0000;emissive:#ff0000"></a-entity><a-entity position="-0.28 0.348 -0.726" scale="0.164 0.944 0.085" id="LetterL-2" geometry="" material="color:#ff0000;emissive:#ff0000"></a-entity><a-entity position="1.327 0.4730241547981132 -0.147" scale="0.139 0.529 0.085" id="LetterO" geometry="" material="color:#ff0000;emissive:#ff0000"></a-entity><a-entity position="0.892 0.43 -1.149" scale="0.132 0.641 0.085" id="LetterO-4" geometry="" material="color:#ff0000;emissive:#ff0000"></a-entity><a-entity position="1.291 0.697 -0.42" rotation="89.897 0 0" scale="0.154 0.547 0.085" id="LetterO-2" geometry="" material="color:#ff0000;emissive:#ff0000"></a-entity><a-entity position="-0.899 -0.173 -2.665" rotation="89.897 0 0" scale="0.263 0.989 0.117" id="LetterO-3" geometry="" material="color:#ff0000;emissive:#ff0000"></a-entity>
    </a-scene>

    <script>
        this.scene = document.querySelector('a-scene');
        this.scene.renderer.gammaOutput = true;
        this.diorama = document.querySelector('#diorama');
        this.reticle = document.querySelector('[reticle]');
        this.touched = this.touched.bind(this)
        this.reticle.addEventListener('touched', this.touched);
        function touched(){
          this.reticle.removeEventListener('touched', this.touched);
          this.diorama.setAttribute('position', this.reticle.getAttribute('position'));
          var rotationOnClick = Math.atan2( ( this.scene.camera.getWorldPosition().x - this.diorama.getAttribute('position').x ), ( this.scene.camera.getWorldPosition().z - this.diorama.getAttribute('position').z ) );
          rotationOnClick = THREE.Math.radToDeg(rotationOnClick) - 90;
          this.diorama.setAttribute('rotation', {y: rotationOnClick});
          this.reticle.parentNode.removeChild(this.reticle);
          this.diorama.setAttribute('visible', true);
        }
    </script>
  </body>
</html>
