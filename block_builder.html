<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Block Builder</title>
    <meta name="description" content="Building Blocks">
    <script src="https://aframe.io/releases/0.9.0/aframe.min.js"></script>
    <script src="https://rawgit.com/ngokevin/kframe/csstricks/scenes/aincraft/components/random-color.js"></script>
    <script src="https://rawgit.com/ngokevin/kframe/csstricks/scenes/aincraft/components/snap.js"></script>
    <script src="https://unpkg.com/aframe-controller-cursor-component@0.2.7/dist/aframe-controller-cursor-component.min.js"></script>
    <script src="scripts\teleport-controls\dist\aframe-teleport-controls.js"></script>
    <script src="scripts\widgets\dist\aframe-ui-widgets.min.js"></script>
    <script src="scripts\detect-controllers\dist\aframe-auto-detect-controllers-component.js"></script>
    <script src="scripts\main.js"></script>
  </head>
  <body>

<a-scene>
  <a-assets>
    <img id="ground" src="https://cdn.aframe.io/a-painter/images/floor.jpg">
    <img id="skyTexture" src="https://cdn.aframe.io/a-painter/images/sky.jpg">
    <a-mixin id="voxel" geometry="primitive: box; height: 0.5; width: 0.5; depth: 0.5" material="shader: standard" random-color snap="offset: 0.25 0.25 0.25; snap: 0.5 0.5 0.5"></a-mixin>
  </a-assets>

  <a-sky id="background" src="#skyTexture" theta-length="90" radius="30"></a-sky>
  <a-cylinder id="ground" src="#ground" radius="30" height="0.1"></a-cylinder>

  <a-entity id="teleHand" auto-detect-controllers="hand:left" teleport-controls="type: parabolic; collisionEntities: [mixin='voxel'], #ground"></a-entity>
  <a-entity id="blockHand" auto-detect-controllers="hand:right" laser-controls intersection-spawn="event: click; mixin: voxel"></a-entity>

  <!-- <a-entity mixin="voxel" position="-1 0 -2"></a-entity>
  <a-entity mixin="voxel" position="0 0 -2"></a-entity>
  <a-entity mixin="voxel" position="0 1 -2"></a-entity>
  <a-entity mixin="voxel" position="1 0 -2"></a-entity> -->

    <a-camera id="Camera" position="0 1.6 0" look-controls="pointerLockEnabled: true">
        <a-cursor id="Cursor" touch-listener intersection-spawn="event: click; mixin: voxel"></a-cursor>
    </a-camera>

    <a-entity id="button_area" position="0 -.25 0">
      <a-entity id="table" geometry="height: 3; depth: 0.25" rotation="-90 0 0" position="-3 1 0" scale=".5 .8 .5" material="color: white"> </a-entity>
      <a-entity id="button1" ui-button="" position="-3 1.075 1" rotation="0 -90 0" scale="1 1 1" visible="true" cursor-listener=""></a-entity>
      <a-entity id="button2" ui-button="" position="-3 1.075 0" rotation="0 -90 0" scale="1 1 1" visible="true" cursor-listener=""></a-entity>
      <a-entity id="button3" ui-button="" position="-3 1.075 -1" rotation="0 -90 0" scale="1 1 1" visible="true" cursor-listener=""></a-entity>
    </a-entity>



    <script>
      document.querySelector('#blockHand').addEventListener(`click`, function (evt) {
      // Create a blank entity.
      var newVoxelEl = document.createElement('a-entity');

      // Use the mixin to make it a voxel.
      newVoxelEl.setAttribute('mixin', 'voxel');

      // Set the position using intersection point. The `snap` component above which
      // is part of the mixin will snap it to the closest half meter.
      newVoxelEl.setAttribute('position', evt.detail.intersection.point);

      // Add to the scene with `appendChild`.
      this.appendChild(newVoxelEl);
    });

    AFRAME.registerComponent('intersection-spawn', {
      schema: {
        default: '',
        parse: AFRAME.utils.styleParser.parse
      },

      init: function () {
        const data = this.data;
        const el = this.el;

        el.addEventListener(data.event, evt => {
          // Create element.
          const spawnEl = document.createElement('a-entity');

          // Snap intersection point to grid and offset from center.
          spawnEl.setAttribute('position', evt.detail.intersection.point);

          // Set components and properties.
          Object.keys(data).forEach(name => {
            if (name === 'event') { return; }
            AFRAME.utils.entity.setComponentProperty(spawnEl, name, data[name]);
          });

          // Append to scene.
          el.sceneEl.appendChild(spawnEl);
        });
      }
    });
    </script>

</a-scene>

  </body>
</html>
